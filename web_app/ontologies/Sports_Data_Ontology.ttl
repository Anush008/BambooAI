
[ rdf:type owl:Ontology
 ] .

#################################################################
#    Object Properties
#################################################################

:applicableToDataObject rdf:type owl:ObjectProperty ;
                        rdfs:domain :Function ;
                        rdfs:range :DataObjects .

:canBeComputedUsingFunction rdf:type owl:ObjectProperty ;
                            rdfs:domain :DataObjects ;
                            rdfs:range :Function .

:containsActivity rdf:type owl:ObjectProperty ;
                  rdfs:domain :ActivityDataframe ;
                  rdfs:range :Activity .

:containsLap rdf:type owl:ObjectProperty ;
             rdfs:domain :Activity ;
             rdfs:range :Segment .

:containsSegment rdf:type owl:ObjectProperty ;
                 rdfs:domain :Activity ;
                 rdfs:range :Segment .

:containsWellnessAggregate rdf:type owl:ObjectProperty ;
                           rdfs:domain :WellnessDataframe ;
                           rdfs:range :WellnessMeasurement .

:derivedFrom rdf:type owl:ObjectProperty ;
             rdfs:domain :Derived ;
             rdfs:range :DirectlyMeasured ,
                        :PreComputed .

:functionRequiresMeasurements rdf:type owl:ObjectProperty ;
                              rdfs:domain :Function ;
                              rdfs:range :MeasurementCategory .

:groupedBy rdf:type owl:ObjectProperty ;
           rdfs:domain :DataObjects ;
           rdfs:range :Key .

:hasRelation rdf:type owl:ObjectProperty ;
             rdfs:domain :Key ,
                         :Measurement ;
             rdfs:range :Key .

:hasUniqueIdentifier rdf:type owl:ObjectProperty ;
                     rdfs:domain :DataObjects ,
                                 :MeasurementCategory ;
                     rdfs:range :Key .

:preComputedFrom rdf:type owl:ObjectProperty ;
                 rdfs:domain :PreComputed ;
                 rdfs:range :DirectlyMeasured ,
                            :PreComputed .

#################################################################
#    Data properties
#################################################################

:allowedValues rdf:type owl:DatatypeProperty ;
               rdfs:domain :Key ;
               rdfs:range xsd:string .

:computeTimeseriesStats rdf:type owl:DatatypeProperty ;
                        rdfs:domain :Timeseries ;
                        rdfs:range xsd:string .

:derivedUsingFormula rdf:type owl:DatatypeProperty ;
                     rdfs:domain :Measurement ;
                     rdfs:range xsd:string .

:functionDefinition rdf:type owl:DatatypeProperty ;
                    rdfs:domain :Function ;
                    rdfs:range xsd:string .

:isPresentInDataset rdf:type owl:DatatypeProperty ;
                    rdfs:domain :Key ,
                                :Measurement ;
                    rdfs:range xsd:boolean .

:measuredInUnits rdf:type owl:DatatypeProperty ;
                 rdfs:domain :Measurement ;
                 rdfs:range xsd:string .

:recordedWithFrequency rdf:type owl:DatatypeProperty ;
                       rdfs:domain :Measurement ;
                       rdfs:range xsd:string .

#################################################################
#    Classes
#################################################################

:Activity rdf:type owl:Class ;
          rdfs:subClassOf :Timeseries ;
          rdfs:comment "A single activity session, containing multiple rows of measurements at regular intervals." .

:ActivityDataframe rdf:type owl:Class ;
                   rdfs:subClassOf :Dataframe ;
                   rdfs:comment "A container for multiple activities and coresponding measurements, organized as time series data." .

:ActivityDataframeIndex rdf:type owl:Class ;
                        rdfs:subClassOf :Index ;
                        rdfs:comment "activity_id-indexed summary providing a condensed view of Activities  with aggregated metrics. Enables quick filtering and reference to detailed data in the original Dataframe." .

:ActivityMeasurement rdf:type owl:Class ;
                     rdfs:subClassOf :Measurement ;
                     rdfs:comment "A single value in the ActivityDataframee, representing measurements at a specific timestamp within an activity." .

:DataObjects rdf:type owl:Class .

:Dataframe rdf:type owl:Class ;
           rdfs:subClassOf :Timeseries .

:DatasourceType rdf:type owl:Class .

:Derived rdf:type owl:Class ;
         rdfs:subClassOf :MeasurementType .

:DirectlyMeasured rdf:type owl:Class ;
                  rdfs:subClassOf :MeasurementType .

:Environmental rdf:type owl:Class ;
               rdfs:subClassOf :MeasurementCategory .

:Function rdf:type owl:Class .

:Geospatial rdf:type owl:Class ;
            rdfs:subClassOf :MeasurementCategory .

:Index rdf:type owl:Class ;
       rdfs:subClassOf :DataObjects .

:Instrument rdf:type owl:Class .

:Key rdf:type owl:Class .

:List rdf:type owl:Class ;
      rdfs:subClassOf :DataObjects ;
      rdfs:comment "A list of computed values" .

:Map rdf:type owl:Class ;
     rdfs:subClassOf :VisualObjects .

:Measurement rdf:type owl:Class ;
             rdfs:subClassOf :DataObjects .

:MeasurementCategory rdf:type owl:Class .

:MeasurementType rdf:type owl:Class .

:Mechanical rdf:type owl:Class ;
            rdfs:subClassOf :MeasurementCategory .

:Metabolic rdf:type owl:Class ;
           rdfs:subClassOf :MeasurementCategory .

:Plot2D rdf:type owl:Class ;
        rdfs:subClassOf :VisualObjects .

:Plot3D rdf:type owl:Class ;
        rdfs:subClassOf :VisualObjects .

:PreComputed rdf:type owl:Class ;
             rdfs:subClassOf :MeasurementType .

:Primary rdf:type owl:Class ;
         rdfs:subClassOf :DatasourceType .

:Scalar rdf:type owl:Class ;
        rdfs:subClassOf :DataObjects .

:Secondary rdf:type owl:Class ;
           rdfs:subClassOf :DatasourceType .

:Segment rdf:type owl:Class ;
         rdfs:subClassOf :Timeseries ;
         rdfs:comment "A single activity segment, containing multiple measurements at regular intervals. Can be refered to as lap, Interval, time_segment or distance_segment" .

:Temporal rdf:type owl:Class ;
          rdfs:subClassOf :MeasurementCategory .

:Timeseries rdf:type owl:Class ;
            rdfs:subClassOf :DataObjects ;
            rdfs:comment "A sequence of records indexed in time order." .

:Velocity rdf:type owl:Class ;
          rdfs:subClassOf :MeasurementCategory .

:VisualObjects rdf:type owl:Class .

:Wellness rdf:type owl:Class ;
          rdfs:subClassOf :MeasurementCategory .

:WellnessDataframe rdf:type owl:Class ;
                   rdfs:subClassOf :Dataframe ;
                   rdfs:comment "A container of daily wellness metrics tracking various health-related indicators, with each row representing a single day's measurements across multiple dimensions of well-being." .

:WellnessMeasurement rdf:type owl:Class ;
                     rdfs:subClassOf :Measurement ;
                     rdfs:comment "A single value in the welness_dataframe, representing measurements at a specific point in time (daily) for a particular wellness metric or health indicator." .


#################################################################
#    Individuals
#################################################################

:respiration_rate rdf:type owl:NamedIndividual ,
                           :ActivityMeasurement ,
                           :DirectlyMeasured ,
                           :Metabolic ;
                  :hasRelation :activity_id ,
                               :datetime ,
                               :lap_id ,
                               :sport ;
                  :isPresentInDataset "true"^^xsd:boolean ;
                  :measuredInUnits "Breaths per Minute" ;
                  :recordedWithFrequency "1 Second" .

:activity rdf:type owl:NamedIndividual ,
                   :Activity ;
          :containsLap :lap ;
          :containsSegment :distance_segment ,
                           :time_segment ;
          :groupedBy :activity_id ;
          :hasUniqueIdentifier :activity_id .

:activity_dataframe rdf:type owl:NamedIndividual ,
                             :ActivityDataframe ,
                             :Primary ;
                    :containsActivity :activity .

:activity_dataframe_index rdf:type owl:NamedIndividual ,
                                   :ActivityDataframeIndex ;
                          :canBeComputedUsingFunction :compute_dataframe_index_function .

:activity_id rdf:type owl:NamedIndividual ,
                      :Key ;
             :hasRelation :athlete_id ;
             :isPresentInDataset "true"^^xsd:boolean .

:air_temperature rdf:type owl:NamedIndividual ,
                          :ActivityMeasurement ,
                          :DirectlyMeasured ,
                          :Environmental ;
                 :hasRelation :activity_id ,
                              :datetime ,
                              :lap_id ,
                              :sport ;
                 :isPresentInDataset "true"^^xsd:boolean ;
                 :measuredInUnits "Celsius" ;
                 :recordedWithFrequency "1 Second" .

:athlete_id rdf:type owl:NamedIndividual ,
                     :Key ;
            :isPresentInDataset "true"^^xsd:boolean .

:average_stress rdf:type owl:NamedIndividual ,
                         :Derived ,
                         :Wellness ,
                         :WellnessMeasurement ;
                :hasUniqueIdentifier :date ;
                :isPresentInDataset "true"^^xsd:boolean ;
                :recordedWithFrequency "1 Day" .

:bmi rdf:type owl:NamedIndividual ,
              :Derived ,
              :Wellness ,
              :WellnessMeasurement ;
     :hasUniqueIdentifier :date ;
     :isPresentInDataset "true"^^xsd:boolean ;
     :measuredInUnits "Percent" ;
     :recordedWithFrequency "1 Day" ;
     rdfs:comment "Body Mass Index" .

:body_weight rdf:type owl:NamedIndividual ,
                      :DirectlyMeasured ,
                      :Wellness ,
                      :WellnessMeasurement ;
             :hasUniqueIdentifier :date ;
             :isPresentInDataset "true"^^xsd:boolean ;
             :measuredInUnits "kg" ;
             :recordedWithFrequency "1 Day" .

:cadence rdf:type owl:NamedIndividual ,
                  :ActivityMeasurement ,
                  :DirectlyMeasured ,
                  :Mechanical ;
         :hasRelation :activity_id ,
                      :datetime ,
                      :lap_id ,
                      :sport ;
         :isPresentInDataset "true"^^xsd:boolean ;
         :measuredInUnits "RPM" ;
         :recordedWithFrequency "1 Second" .

:calculate_hr_drift rdf:type owl:NamedIndividual ,
                             :Function ;
                    :applicableToDataObject :activity ;
                    :functionRequiresMeasurements :datetime ,
                                                  :heart_rate ,
                                                  :power ;
                    :functionDefinition """Calculate HR drift using power data for exertion normalization.
Imports:
    import pandas as pd
    import numpy as np
    from scipy import stats

Parameters:
    df (pandas.DataFrame): DataFrame containing at least 'datetime', 'heart_rate', and 'power' columns.

Returns:
    float: HR drift per hour (normalized units per hour)

Function Body:    
    # Ensure the DataFrame is sorted by datetime
    df['datetime'] = pd.to_datetime(df['datetime'])
    df = df.sort_values('datetime')
    # Filter out rows with missing or zero values for heart_rate and power
    df = df[(df['heart_rate'] > 0) & (df['power'] > 0)]
    # If there's not enough data after filtering, return NaN
    if len(df) < 20 * 60:
        return np.nan
    # Calculate time elapsed in minutes
    df['TimeElapsed'] = (df['datetime'] - df['datetime'].iloc[0]).dt.total_seconds() / 60
    # Filter out the first 20 minutes of activity
    df_steady = df[df['TimeElapsed'] >= 20]
    # If there's not enough data after filtering, return NaN
    if len(df_steady) < 10 * 60: 
        return np.nan
    # Normalize heart rate based on power output
    df_steady['HR_per_Watt'] = df_steady['heart_rate'] / df_steady['power']
    # Calculate moving averages to smooth out noise
    window_size = 60
    df_steady['HR_per_Watt_MA'] = df_steady['HR_per_Watt'].rolling(window=window_size, center=True).mean()
    # Remove NaN values that may have been introduced by the rolling mean
    df_steady = df_steady.dropna(subset=['HR_per_Watt_MA'])
    # If there's not enough data after removing NaNs, return NaN
    if len(df_steady) < 10 * 60:  # Changed from 10 to 10 * 60
        return np.nan
    # Linear regression to find the slope of HR increase
    slope, *, *, *, * = stats.linregress(df_steady['TimeElapsed'], df_steady['HR_per_Watt_MA'])
    # Calculate drift per hour
    drift_per_hour = slope * 60
    return drift_per_hour""" ;
                    rdfs:comment "This function is used  to measure cardiovascular drift during endurance activities by analyzing how heart rate changes relative to power output over time, helping identify fatigue patterns and heat adaptation needs." .

:calculate_pace_function rdf:type owl:NamedIndividual ,
                                  :Function ;
                         :applicableToDataObject :activity ;
                         :functionRequiresMeasurements :speed ;
                         :functionDefinition """Calculate pace for various activities.
    Imports:
        import numpy as np
        import pandas as pd
    
    Parameters:
        df (pd.DataFrame): DataFrame containing the data
        speed_col (str): Name of the column containing speed values in m/s
        activity_col (str): Name of the column containing activity types
    
    Returns:
        pd.DataFrame: DataFrame with added 'pace' column
                      (running: min/km, swimming: min/100m, cycling: km/h)
    
    Function Body:    
        # Remove invalid speeds and activities
        df = df[(df[speed_col] > 0) & df[activity_col].notna()].copy()
        
        # Create masks for each activity type
        run_mask = (df[activity_col].str.lower() == 'run')
        swim_mask = (df[activity_col].str.lower() == 'swim')
        ride_mask = (df[activity_col].str.lower() == 'ride')
        
        # Calculate pace for each activity type
        df['pace'] = np.nan
        df.loc[run_mask, 'pace'] = 1000 / (df.loc[run_mask, speed_col] * 60)  # min/km
        df.loc[swim_mask, 'pace'] = 100 / (df.loc[swim_mask, speed_col] * 60)  # min/100m
        df.loc[ride_mask, 'pace'] = df.loc[ride_mask, speed_col] * 3.6  # km/h
        
        # Remove rows with invalid pace values
        df = df[df['pace'].notna() & (df['pace'] > 0)]
        
        return df""" ;
                         rdfs:comment "This function is used  to convert speed data into sport-specific pace metrics (running in min/km, swimming in min/100m, cycling in km/h) when analyzing mixed activity data that includes running, swimming, and cycling." .

:calories rdf:type owl:NamedIndividual ,
                   :ActivityMeasurement ,
                   :Derived ,
                   :Metabolic ;
          :derivedFrom :power ;
          :hasRelation :activity_id ,
                       :datetime ,
                       :lap_id ,
                       :sport ;
          :derivedUsingFormula "(power * (1.0/3600) * 3.6 / 0.24)" ;
          :isPresentInDataset "true"^^xsd:boolean ;
          :measuredInUnits "cal (calories)" ;
          :recordedWithFrequency "1 Second" ;
          rdfs:comment "calories burned during activity" .

:calories_burnt rdf:type owl:NamedIndividual ,
                         :Derived ,
                         :Metabolic ,
                         :WellnessMeasurement ;
                :hasUniqueIdentifier :date ;
                :isPresentInDataset "true"^^xsd:boolean ;
                :measuredInUnits "cal (calories)" ;
                :recordedWithFrequency "1 Day" ;
                rdfs:comment "Daily Calorie Expenditure" .

:calories_consumed rdf:type owl:NamedIndividual ,
                            :Derived ,
                            :Metabolic ,
                            :WellnessMeasurement ;
                   :hasUniqueIdentifier :date ;
                   :isPresentInDataset "true"^^xsd:boolean ;
                   :measuredInUnits "cal (calories)" ;
                   :recordedWithFrequency "1 Day" ;
                   rdfs:comment "Daily calorie consumption" .

:compute_dataframe_index_function rdf:type owl:NamedIndividual ,
                                           :Function ;
                                  :applicableToDataObject :activity_dataframe ;
                                  :functionDefinition """Create an index of activities by computing summary statistics for each activity in the original dataframe. This index provides a condensed view of activities, enabling quick lookup and filtering based on various attributes, and serves as an efficient reference point for accessing detailed data in the original dataframe.

Parameters:
    df (pandas.DataFrame): The input DataFrame containing detailed activity data with multiple rows per activity
    order_by (str, optional): Column name to sort the resulting index DataFrame by. Defaults to 'datetime
    ascending (bool, optional): Sort order for the index. True for ascending, False for descending. Defaults to False (descending).

Returns:
    pandas.DataFrame: Index DataFrame containing activity summaries, with one row per activity, including columns: activity_id, sport, datetime, distance, duration, avg_speed, start_latitude, start_longitude, avg_elevation, avg_heartrate, avg_cadence, avg_power, number_of_laps

Function Body:
    # Ensure datetime is in datetime format
    if df['datetime'].dtype == 'object':
        df['datetime'] = pd.to_datetime(df['datetime'], errors='coerce')

    # Define aggregation functions - only include columns that exist
    all_agg_functions = {
        'sport': 'first',
        'datetime': 'min',
        'distance': lambda x: np.abs(x.max() - x.min()),
        'latitude': 'first',
        'longitude': 'first',
        'elevation': 'mean',
        'speed': 'mean',
        'heart_rate': 'mean',
        'cadence': 'mean',
        'power': 'mean',
        'lap_id': 'max',
    }
    
    agg_functions = {col: func for col, func in all_agg_functions.items() if col in df.columns}

    # Compute statistics for each activity
    activity_stats = df.groupby('activity_id').agg(agg_functions).reset_index()

    # Calculate duration
    activity_stats['duration'] = df.groupby('activity_id')['datetime'].apply(
        lambda x: (x.max() - x.min()).total_seconds()
    ).values

    # Create column mapping for renaming - only for existing columns
    column_mapping = {
        'sport': 'sport', 'datetime': 'datetime', 'distance': 'distance',
        'latitude': 'start_latitude', 'longitude': 'start_longitude',
        'elevation': 'avg_elevation', 'speed': 'avg_speed', 'heart_rate': 'avg_heartrate',
        'cadence': 'avg_cadence', 'power': 'avg_power', 'lap_id': 'number_of_laps'
    }
    
    # Rename only existing columns
    rename_dict = {col: column_mapping[col] for col in activity_stats.columns if col in column_mapping}
    activity_stats = activity_stats.rename(columns=rename_dict)

    # Round numeric columns to 3 decimal places
    numeric_cols = activity_stats.select_dtypes(include=[np.number]).columns
    activity_stats[numeric_cols] = activity_stats[numeric_cols].round(3)

    # Ensure number_of_laps is an integer if it exists
    if 'number_of_laps' in activity_stats.columns:
        activity_stats['number_of_laps'] = activity_stats['number_of_laps'].fillna(0).astype(int)

    return activity_stats.sort_values(by=order_by, ascending=ascending)""" ;
                                  rdfs:comment "This function is used to create a high-level summary of athletic activities by generating a single-row-per-activity index containing key metrics like distance, duration, and averages, useful for activity browsing, filtering, and quick analytics without processing the full raw data." .

:compute_functional_threshold_power_function rdf:type owl:NamedIndividual ,
                                                      :Function ;
                                             :applicableToDataObject :activity ;
                                             :functionRequiresMeasurements :datetime ,
                                                                           :power ;
                                             :functionDefinition """Calculate the highest Functional Threshold power (FTP) from power data.

Parameters:
    df (pd.DataFrame): DataFrame containing the activity data

Returns:
    int: Highest calculated FTP value in watts

Function Body:
    # Convert datetime column to datetime type
    df['datetime'] = pd.to_datetime(df['datetime'])
    # Sort DataFrame by datetime
    df = df.sort_values('datetime')
    # Calculate rolling 20-minute average power
    window_size = 20 * 60  # 20 minutes in 1-second intervals
    rolling_power = df['power'].rolling(window=window_size, center=False).mean()
    # Find maximum 20-minute power
    max_20min_power = rolling_power.max()
    # Calculate and round FTP
    highest_ftp = round(max_20min_power * 0.95)
    return int(highest_ftp)""" ;
                                             rdfs:comment "This function is used to estimate a cyclist's Functional Threshold power (FTP) from raw power data by identifying their best 20-minute power output from any ride or training session." .

:compute_mean_max_curve_function rdf:type owl:NamedIndividual ,
                                          :Function ;
                                 :applicableToDataObject :activity ,
                                                         :activity_dataframe ,
                                                         :lap ;
                                 :functionDefinition """Calculate the maximum rolling mean for a measurement and various window sizes.

Parameters:
    df (pd.DataFrame): DataFrame containing the data
    measurement (str): Column name of the measurement
    windows (list of int): List of window sizes

Returns:
    list of float: Maximum rolling mean values for each window size

Function Body:
    windows = [1,5,10,30,60,180,300, 600, 1200,3600]
    mean_maximal_powers = []
    for window in windows:
        rolling_mean = df[measurement].rolling(window=window).mean()
        max_rolling_mean = rolling_mean.max()
        mean_maximal_powers.append(max_rolling_mean)""" ;
                                 rdfs:comment "This function is used to identify the maximal sustained output over different time durations in athletic performance data, such as power output, heart rate, speed, or any other performance metric that requires rolling mean analysis." .

:daily_steps rdf:type owl:NamedIndividual ,
                      :PreComputed ,
                      :Wellness ,
                      :WellnessMeasurement ;
             :hasUniqueIdentifier :date ;
             :isPresentInDataset "true"^^xsd:boolean ;
             :measuredInUnits "Steps" ;
             :recordedWithFrequency "1 Day" .

:daily_walking_distance rdf:type owl:NamedIndividual ,
                                 :PreComputed ,
                                 :Wellness ,
                                 :WellnessMeasurement ;
                        :hasUniqueIdentifier :date ;
                        :isPresentInDataset "true"^^xsd:boolean ;
                        :measuredInUnits "meters" ;
                        :recordedWithFrequency "1 Day" ;
                        rdfs:comment "Walking distance accumulated throughout the day, combining both exercise and routine movement." .

:date rdf:type owl:NamedIndividual ,
               :DirectlyMeasured ,
               :Key ,
               :Temporal ,
               :Wellness ,
               :WellnessMeasurement ;
      :hasRelation :activity_dataframe_index ;
      :isPresentInDataset "true"^^xsd:boolean ;
      :measuredInUnits "ISO 8601" ;
      :recordedWithFrequency "1 Day" .

:datetime rdf:type owl:NamedIndividual ,
                   :ActivityMeasurement ,
                   :DirectlyMeasured ,
                   :Key ,
                   :Temporal ;
          :hasRelation :activity_id ,
                       :lap_id ,
                       :sport ;
          :isPresentInDataset "true"^^xsd:boolean ;
          :measuredInUnits "ISO 8601" ;
          :recordedWithFrequency "1 Second" .

:determine_segments_function rdf:type owl:NamedIndividual ,
                                      :Function ;
                             :applicableToDataObject :activity ;
                             :functionDefinition """Create segments based on either time or distance for data grouped by activity_id.
Segments that are not complete (don't match the full segment duration/distance) are marked as null.

Parameters:
    df (pandas.DataFrame): The input DataFrame
    segment_type (str): Type of segmentation, either 'time' or 'distance' (default: 'time')
    segment_duration (int): Time interval in seconds for segmentation (default: 1200, which is 20 minutes)
    segment_distance (float): distance in meters for each segment (default: 1000, which is 1km)
    
Returns:
    pandas.DataFrame: DataFrame with an additional column for segment id.
                     Complete segments are numbered (0, 1, 2, ...), incomplete segments are null.

Function Body:    
    # Ensure the datetime column is in datetime format
    df['datetime'] = pd.to_datetime(df['datetime'])
    
    # Sort the DataFrame by activity_id and datetime
    df = df.sort_values(by=['activity_id', 'datetime'])
    
    if segment_type == 'time':
        # Group by activity_id and calculate time-based segments
        def process_time_group(group):
            # Calculate total seconds for the activity
            total_seconds = (group['datetime'].max() - group['datetime'].min()).total_seconds()
            # Calculate number of complete segments
            complete_segments = int(total_seconds // segment_duration)
            
            # Assign segment numbers
            segment_seconds = (group['datetime'] - group['datetime'].min()).dt.total_seconds()
            group['segment_id'] = (segment_seconds // segment_duration).astype(int)
            
            # Set incomplete segments to null
            group.loc[group['segment_id'] >= complete_segments, 'segment_id'] = np.nan
            
            return group
        
        df = df.groupby('activity_id', group_keys=False).apply(process_time_group)
    
    elif segment_type == 'distance':
        # Process each activity separately
        def process_distance_group(group):
            # Calculate total distance and complete segments
            total_distance = group['distance'].max()
            complete_segments = int(total_distance // segment_distance)
            
            # Assign segment numbers
            group['segment_id'] = (group['distance'] // segment_distance).astype(int)
            
            # Set incomplete segments to null
            group.loc[group['segment_id'] >= complete_segments, 'segment_id'] = np.nan
            
            return group
        
        df = df.groupby('activity_id', group_keys=False).apply(process_distance_group)
    
    else:
        raise ValueError(\"segment_type must be either 'time' or 'distance'\")
    
    return df""" ;
                             rdfs:comment "This function is used to split athletic activities into equal intervals (time-based or distance-based) for analyzing segments, splits, laps, or any interval-based performance analysis." .

:distance rdf:type owl:NamedIndividual ,
                   :ActivityMeasurement ,
                   :Geospatial ,
                   :PreComputed ;
          :hasRelation :activity_id ,
                       :datetime ,
                       :lap_id ,
                       :sport ;
          :preComputedFrom :latitude ,
                           :longitude ;
          :isPresentInDataset "true"^^xsd:boolean ;
          :measuredInUnits "Meters" ;
          :recordedWithFrequency "1 Second" .

:distance_segment rdf:type owl:NamedIndividual ,
                           :Segment ;
                  :groupedBy :segment_id ;
                  :hasUniqueIdentifier :segment_id ;
                  rdfs:comment "A single distance based segment during activity, containing multiple measurements at regular intervals" .

:elevation rdf:type owl:NamedIndividual ,
                    :ActivityMeasurement ,
                    :DirectlyMeasured ,
                    :Geospatial ;
           :hasRelation :activity_id ,
                        :datetime ,
                        :lap_id ,
                        :sport ;
           :isPresentInDataset "true"^^xsd:boolean ;
           :measuredInUnits "Meters" ;
           :recordedWithFrequency "1 Second" .

:floors_ascended rdf:type owl:NamedIndividual ,
                          :Derived ,
                          :Wellness ,
                          :WellnessMeasurement ;
                 :hasUniqueIdentifier :date ;
                 :isPresentInDataset "true"^^xsd:boolean ;
                 :measuredInUnits "Floors" ;
                 :recordedWithFrequency "1 Day" .

:floors_descended rdf:type owl:NamedIndividual ,
                           :Derived ,
                           :Wellness ,
                           :WellnessMeasurement ;
                  :hasUniqueIdentifier :date ;
                  :isPresentInDataset "true"^^xsd:boolean ;
                  :measuredInUnits "Floors" ;
                  :recordedWithFrequency "1 Day" .

:functional_threshold_power rdf:type owl:NamedIndividual ,
                                     :Scalar ;
                            :canBeComputedUsingFunction :compute_functional_threshold_power_function ;
                            rdfs:comment "Highest average power output that can be sustained for approximately one hour." .

:gradient rdf:type owl:NamedIndividual ,
                   :ActivityMeasurement ,
                   :Geospatial ,
                   :PreComputed ;
          :hasRelation :activity_id ,
                       :datetime ,
                       :lap_id ,
                       :sport ;
          :preComputedFrom :distance ,
                           :elevation ;
          :isPresentInDataset "true"^^xsd:boolean ;
          :measuredInUnits "Percent" ;
          :recordedWithFrequency "1 Second" ;
          rdfs:comment "Ratio of the vertical gain to the horizontal distance covered, expressed as a percentage" .

:heart_rate rdf:type owl:NamedIndividual ,
                     :ActivityMeasurement ,
                     :DirectlyMeasured ,
                     :Metabolic ;
            :hasRelation :activity_id ,
                         :datetime ,
                         :lap_id ,
                         :sport ;
            :isPresentInDataset "true"^^xsd:boolean ;
            :measuredInUnits "BPM" ;
            :recordedWithFrequency "1 Second" .

:hr_drift rdf:type owl:NamedIndividual ,
                   :Scalar ;
          :canBeComputedUsingFunction :calculate_hr_drift ;
          rdfs:comment "HR drift, or heart rate drift, is a phenomenon observed during prolonged endurance exercise. It refers to the gradual increase in heart rate over time while maintaining the same level of exertion or exercise intensity." .

:humidity rdf:type owl:NamedIndividual ,
                   :ActivityMeasurement ,
                   :DirectlyMeasured ,
                   :Environmental ;
          :hasRelation :activity_id ,
                       :datetime ,
                       :lap_id ,
                       :sport ;
          :isPresentInDataset "false"^^xsd:boolean ;
          :measuredInUnits "Percent" ;
          :recordedWithFrequency "1 Second" .

:lap rdf:type owl:NamedIndividual ,
              :Segment ;
     :groupedBy :lap_id ;
     :hasUniqueIdentifier :lap_id .

:lap_id rdf:type owl:NamedIndividual ,
                 :Key ;
        :hasRelation :activity_id ;
        :isPresentInDataset "true"^^xsd:boolean .

:latitude rdf:type owl:NamedIndividual ,
                   :ActivityMeasurement ,
                   :DirectlyMeasured ,
                   :Geospatial ;
          :hasRelation :activity_id ,
                       :datetime ,
                       :lap_id ,
                       :sport ;
          :isPresentInDataset "true"^^xsd:boolean ;
          :measuredInUnits "Degrees" ;
          :recordedWithFrequency "1 Second" .

:longitude rdf:type owl:NamedIndividual ,
                    :ActivityMeasurement ,
                    :DirectlyMeasured ,
                    :Geospatial ;
           :hasRelation :activity_id ,
                        :datetime ,
                        :lap_id ,
                        :sport ;
           :isPresentInDataset "true"^^xsd:boolean ;
           :measuredInUnits "Degrees" ;
           :recordedWithFrequency "1 Second" .

:map_plot rdf:type owl:NamedIndividual ,
                   :Map ;
          :canBeComputedUsingFunction :map_plot_function ;
          rdfs:comment "A geographical visualization showing your activity data points overlaid on a map, allowing you to see where your activities took place on an actual map background." .

:map_plot_function rdf:type owl:NamedIndividual ,
                            :Function ;
                   :applicableToDataObject :activity ;
                   :functionRequiresMeasurements :latitude ,
                                                 :longitude ;
                   :functionDefinition """Create an interactive map plot from a DataFrame with longitude and latitude columns
Parameters:
    df (pd.DataFrame): DataFrame containing the data to be plotted
    longitude (str): Column name for longitude data
    latitude (str): Column name for latitude data
    zoom (int, optional): Initial zoom level for the map. Default is 10
    style (str, optional): Map style to use. Default is 'carto-positron'
    point_size (int, optional): Size of the scatter points. Default is 8
    opacity (float, optional): Opacity value for points. Default is 0.7
    marker_color (str, optional): Color for points. Default is 'blue'
    hover_data (list, optional): List of column names to show in hover tooltip. Default is None
Returns:
    plotly.graph_objects.Figure: Interactive map figure ready for display
Function Body:
    import pandas as pd
    import plotly.express as px

    fig = px.scatter_mapbox(
        df,
        lat=latitude,
        lon=longitude,
        zoom=zoom,
        opacity=opacity,
        size_max=point_size,
        color_discrete_sequence=[marker_color],
        hover_data=hover_data
    )

    fig.update_layout(
        mapbox_style=style,
        dragmode='pan',
        hovermode='closest',
        autosize=True,
        mapbox=dict(
            center=dict(
                lat=df[latitude].mean(),
                lon=df[longitude].mean()
            )
        )
    )

    fig.show()""" ;
                   rdfs:comment "This function is used to visualize athletic activities like running routes, cycling paths, player movements, training sessions, or any GPS-tracked sports data that needs to be displayed on a map background." .

:mean_max_curve rdf:type owl:NamedIndividual ,
                         :List ;
                :canBeComputedUsingFunction :compute_mean_max_curve_function ;
                rdfs:comment "A record of the maximum sustained output values across standardized time durations, showing an athlete's peak capabilities at each duration." .

:pace rdf:type owl:NamedIndividual ,
               :ActivityMeasurement ,
               :Derived ,
               :Velocity ;
      :canBeComputedUsingFunction :calculate_pace_function ;
      :hasRelation :activity_id ,
                   :datetime ,
                   :lap_id ,
                   :sport ;
      :isPresentInDataset "false"^^xsd:boolean ;
      :measuredInUnits """Run = Minutes per Kilometer
Swim = Minutes per 100 meters
Ride = Kilometers per Hour""" ;
      :recordedWithFrequency "1 Second" .

:plot_2d rdf:type owl:NamedIndividual ,
                  :Plot2D ;
         :canBeComputedUsingFunction :plot_2d_function .

:plot_2d_function rdf:type owl:NamedIndividual ,
                           :Function ;
                  :applicableToDataObject :activity ,
                                          :activity_dataframe_index ,
                                          :distance_segment ,
                                          :lap ,
                                          :time_segment ;
                  :functionDefinition """Create an interactive 2D plot from a DataFrame
Parameters:
    df (pd.DataFrame): DataFrame containing the data to be plotted
    x (str): Column name for x-axis data
    y (str): Column name for y-axis data
    plot_type (str): Type of plot to create using plotly express
    title (str, optional): Plot title. Default is None
    labels (dict, optional): Dictionary of axis labels. Default is None
    color (str, optional): Plot color. Default is '#2ecc71'
    hover_data (list, optional): List of column names for hover tooltip. Default is None
Returns:
    plotly.graph_objects.Figure: Interactive plot ready for display
Function Body:
    import pandas as pd
    import plotly.express as px

    plot_func = getattr(px, plot_type)
    fig = plot_func(
        df, x=x, y=y,
        title=title,
        labels=labels,
        color_discrete_sequence=[color],
        hover_data=hover_data
    )

    fig.update_layout(
        template='plotly_white',
        dragmode='pan',
        hovermode='closest',
        autosize=True
    )

    fig.show()""" ;
                  rdfs:comment "This function is used to create interactive 2D visualizations for analyzing relationships between variables, including time series analysis, categorical comparisons, statistical distributions, correlations and any other data exploration requiring single or multiple variables plotted against one or two axes." .

:plot_3d rdf:type owl:NamedIndividual ,
                  :Plot3D ;
         :canBeComputedUsingFunction :plot_3d .

:plot_3d_function rdf:type owl:NamedIndividual ,
                           :Function ;
                  :applicableToDataObject :activity ,
                                          :activity_dataframe_index ,
                                          :distance_segment ,
                                          :lap ,
                                          :time_segment ;
                  :functionDefinition """Create an interactive 3D plot from a DataFrame
Parameters:
    df (pd.DataFrame): DataFrame containing the data to be plotted
    x (str): Column name for x-axis data
    y (str): Column name for y-axis data
    z (str): Column name for z-axis data
    plot_type (str): Type of 3D plot to create using plotly express
    title (str, optional): Plot title. Default is None
    labels (dict, optional): Dictionary of axis labels. Default is None
    color (str, optional): Plot color. Default is '#2ecc71'
    hover_data (list, optional): List of column names for hover tooltip. Default is None
Returns:
    plotly.graph_objects.Figure: Interactive 3D plot ready for display
Function Body:
    import pandas as pd
    import plotly.express as px

    plot_func = getattr(px, plot_type)
    fig = plot_func(
        df, x=x, y=y, z=z,
        title=title,
        labels=labels,
        color_discrete_sequence=[color],
        hover_data=hover_data
    )

    fig.update_layout(
        template='plotly_white',
        dragmode='pan',
        hovermode='closest',
        autosize=True
    )

    fig.show()""" ;
                  rdfs:comment "This function is used to visualize complex data relationships across three dimensions, particularly useful for spatial data analysis, multi-variable comparisons, or any scenario where depth adds meaningful context to the visualization." .

:power rdf:type owl:NamedIndividual ,
                :ActivityMeasurement ,
                :DirectlyMeasured ,
                :Mechanical ;
       :hasRelation :activity_id ,
                    :datetime ,
                    :lap_id ,
                    :sport ;
       :isPresentInDataset "true"^^xsd:boolean ;
       :measuredInUnits "Watts" ;
       :recordedWithFrequency "1 Second" .

:resting_heart_rate rdf:type owl:NamedIndividual ,
                             :DirectlyMeasured ,
                             :Metabolic ,
                             :WellnessMeasurement ;
                    :hasUniqueIdentifier :date ;
                    :isPresentInDataset "true"^^xsd:boolean ;
                    :measuredInUnits "BPM" ;
                    :recordedWithFrequency "1 Day" .

:segment_id rdf:type owl:NamedIndividual ,
                     :Key ;
            :canBeComputedUsingFunction :determine_segments_function ;
            :hasRelation :activity_id ;
            :isPresentInDataset "false"^^xsd:boolean .

:sleep_duration rdf:type owl:NamedIndividual ,
                         :DirectlyMeasured ,
                         :Wellness ,
                         :WellnessMeasurement ;
                :hasUniqueIdentifier :date ;
                :isPresentInDataset "true"^^xsd:boolean ;
                :measuredInUnits "Seconds" ;
                :recordedWithFrequency "1 Day" .


:speed rdf:type owl:NamedIndividual ,
                :ActivityMeasurement ,
                :PreComputed ,
                :Velocity ;
       :hasRelation :activity_id ,
                    :datetime ,
                    :lap_id ,
                    :sport ;
       :preComputedFrom :datetime ,
                        :distance ;
       :isPresentInDataset "true"^^xsd:boolean ;
       :measuredInUnits "Meters per Second" ;
       :recordedWithFrequency "1 Second" .

:sport rdf:type owl:NamedIndividual ,
                :Key ;
       :hasRelation :activity_id ;
       :allowedValues "Ride" ,
                      "Run" ,
                      "Swim" ;
       :isPresentInDataset "true"^^xsd:boolean ;
       rdfs:comment "A key representing activity type with allowed values: Ride, Swim, Run" .

:time_segment rdf:type owl:NamedIndividual ,
                       :Segment ;
              :groupedBy :segment_id ;
              :hasUniqueIdentifier :segment_id ;
              rdfs:comment "A single time based segment during activity, containing multiple measurements at regular intervals." .

:torque rdf:type owl:NamedIndividual ,
                 :ActivityMeasurement ,
                 :Derived ,
                 :Mechanical ;
        :derivedFrom :cadence ,
                     :power ;
        :hasRelation :activity_id ,
                     :datetime ,
                     :lap_id ,
                     :sport ;
        :derivedUsingFormula """# Calculate torque
import numpy as np
torque = power * 60 / (2 * np.pi * cadence)""" ;
        :isPresentInDataset "false"^^xsd:boolean ;
        :measuredInUnits "Nm (Newton Meters)" ;
        :recordedWithFrequency "1 Second" .

:welness_dataframe rdf:type owl:NamedIndividual ,
                            :Secondary ,
                            :WellnessDataframe ;
                   :containsWellnessAggregate :average_stress ,
                                              :bmi ,
                                              :body_weight ,
                                              :calories_burnt ,
                                              :calories_consumed ,
                                              :daily_steps ,
                                              :daily_walking_distance ,
                                              :date ,
                                              :floors_ascended ,
                                              :floors_descended ,
                                              :resting_heart_rate ,
                                              :sleep_duration ;
                   :groupedBy :date .

:wind_direction rdf:type owl:NamedIndividual ,
                         :ActivityMeasurement ,
                         :DirectlyMeasured ,
                         :Environmental ;
                :hasRelation :activity_id ,
                             :datetime ,
                             :lap_id ,
                             :sport ;
                :isPresentInDataset "false"^^xsd:boolean ;
                :measuredInUnits "Degrees" ;
                :recordedWithFrequency "1 Second" .

:wind_speed rdf:type owl:NamedIndividual ,
                     :ActivityMeasurement ,
                     :DirectlyMeasured ,
                     :Environmental ;
            :hasRelation :activity_id ,
                         :datetime ,
                         :lap_id ,
                         :sport ;
            :isPresentInDataset "false"^^xsd:boolean ;
            :measuredInUnits "Meters per Second" ;
            :recordedWithFrequency "1 Second" .
